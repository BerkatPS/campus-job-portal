import{q as xe,r as d,j as e,a as he,m as R,b as y,R as fe,J as ye,f as x}from"./app-BUVb_nAj.js";import{L as je}from"./Layout-DnkF-NCm.js";import{h as z}from"./moment-C5S46NFB.js";import"./id-DNGKkZzB.js";import{u as ge,B as i,T as c,a as _,P as be}from"./Button-DFxjcZ8p.js";import{N as b,S as P,A as O}from"./Sidebar-DGzgELZX.js";import{P as ke}from"./Person-5k5xBlAT.js";import{W as Ce,C as k,N as ve}from"./WarningAmber-c8OFJHkt.js";import{E as Ie}from"./Error-CSPDIC8t.js";import{E as Se}from"./Email-E4u4F7F-.js";import{B as J,W as Y,T as A,L as Te,a as C,b as v,M as w}from"./Work-CLEsMByH.js";import{E as H}from"./Event-DRCIx1GO.js";import{C as Pe}from"./Container-DEvTfuj0.js";import{C as q,A as Ae}from"./Slide-DYtCGdXj.js";import{F as we}from"./FilterList-Cvii7KUK.js";import{I as N,L as Ne,D as We,M as U}from"./Button-DzGhUBn7.js";import{M as Me}from"./MoreVert-PY4ZbxeC.js";import{T as De,a as W}from"./Tabs-CQDMEBQN.js";import{C as V}from"./Check-4ptu1-hL.js";import{D as Z}from"./Delete-DjrVMKuP.js";import{P as Fe}from"./Pagination-BCSyKNly.js";import{C as Le}from"./Card-D_rkxkaC.js";import{C as $e}from"./CardContent-DTmJK9ga.js";import"./Footer-DSErbOqA.js";import"./index-Dtg-WGcE.js";import"./CheckCircle-Dd-oaFV0.js";import"./ChevronRight-FNylUib_.js";import"./Info-CdM9Lqya.js";import"./People-6TwBzk5z.js";import"./KeyboardArrowRight-By3nsvSL.js";import"./LastPage-B2IJYsVY.js";const xa=()=>{var B;const{auth:j,notifications:o,unreadCount:m}=xe().props,s=ge(),[l,G]=d.useState(0),[M,I]=d.useState(null),[D,S]=d.useState(null),[n,K]=d.useState("all"),[h,p]=d.useState(!1),[u,g]=d.useState([]);d.useEffect(()=>{if(o&&o.data){const a=o.data.map(t=>{const r=typeof t.data=="string"?JSON.parse(t.data):t.data;return{id:t.id,title:r.title||Q(t.type),message:r.message||"",time:z(t.created_at).fromNow(),date:z(t.created_at).format("YYYY-MM-DD"),type:F(t.type),read:t.read_at!==null,icon:X(t.type),route:r.action_url||"#",action_text:r.action_text||"Lihat Detail",originalData:r}});g(a)}},[o]);const F=a=>a.includes("Job")?"job":a.includes("Application")?"application":a.includes("Interview")?"interview":a.includes("Company")?"company":a.includes("Message")||a.includes("Chat")?"message":a.includes("Forum")?"forum":(a.includes("Welcome")||a.includes("System"),"system"),Q=a=>{const t=a.split("\\");return t[t.length-1].replace(/([A-Z])/g," $1").trim()},X=a=>{switch(F(a)){case"job":return e.jsx(Y,{});case"application":return e.jsx(O,{});case"interview":return e.jsx(H,{});case"company":return e.jsx(J,{});case"message":return e.jsx(k,{});case"system":return e.jsx(P,{});case"forum":return e.jsx(k,{});case"newsletter":return e.jsx(Se,{});case"error":return e.jsx(Ie,{});case"warning":return e.jsx(Ce,{});case"user":return e.jsx(ke,{});default:return e.jsx(b,{})}},ee=(a,t)=>{G(t)},ae=a=>{I(a.currentTarget)},te=()=>{I(null)},se=a=>{S(a.currentTarget)},re=()=>{S(null)},ne=a=>{K(a),S(null)},ie=()=>{p(!0);const a=f();x.post(`${a}/notifications/mark-all-as-read`,{},{onSuccess:()=>{g(u.map(t=>({...t,read:!0}))),I(null)},onFinish:()=>{p(!1)}})},oe=()=>{confirm("Apakah Anda yakin ingin menghapus semua notifikasi?")&&x.reload()},L=a=>{p(!0);const t=f();x.post(`${t}/notifications/${a}/mark-as-read`,{},{onSuccess:()=>{g(u.map(r=>r.id===a?{...r,read:!0}:r))},onFinish:()=>{p(!1)}})},le=a=>{p(!0);const t=f();x.delete(`${t}/notifications/${a}`,{},{onSuccess:()=>{g(u.filter(r=>r.id!==a))},onFinish:()=>{p(!1)}})},f=()=>{if(!j.user||!j.user.role)return"/candidate";const a=j.user.role.id||j.user.role.role_id;return a===1?"/admin":a===2?"/manager":"/candidate"},ce=(a,t)=>{x.visit(`${f()}/notifications?page=${t}`,{preserveState:!0,only:["notifications"]})},T=u.filter(a=>l===0?n==="all"||a.type===n:l===1?!a.read&&(n==="all"||a.type===n):a.read&&(n==="all"||a.type===n)),$=[{type:"all",label:"Semua",icon:e.jsx(b,{})},{type:"job",label:"Lowongan",icon:e.jsx(Y,{})},{type:"application",label:"Lamaran",icon:e.jsx(O,{})},{type:"interview",label:"Interview",icon:e.jsx(H,{})},{type:"company",label:"Perusahaan",icon:e.jsx(J,{})},{type:"message",label:"Pesan",icon:e.jsx(k,{})},{type:"system",label:"Sistem",icon:e.jsx(P,{})},{type:"forum",label:"Forum",icon:e.jsx(k,{})}],de=((B=$.find(a=>a.type===n))==null?void 0:B.label)||"Semua",me=n==="all"?m:u.filter(a=>!a.read&&a.type===n).length,E=a=>{var t;switch(a){case"job":return s.palette.primary.main;case"application":return s.palette.success.main;case"interview":return s.palette.warning.main;case"company":return s.palette.info.main;case"message":return s.palette.secondary.main;case"system":return s.palette.grey[700];case"forum":return((t=s.palette.purple)==null?void 0:t.main)||"#9c27b0";case"error":return s.palette.error.main;default:return s.palette.primary.main}},pe=a=>{a.read||L(a.id),a.route&&a.route!=="#"&&x.visit(a.route)},ue=()=>l===0?"Notifikasi":l===1?`Notifikasi Belum Dibaca (${me})`:`Notifikasi Sudah Dibaca (${T.length})`;return e.jsxs(je,{children:[e.jsx(he,{title:ue()}),e.jsxs(Pe,{maxWidth:"lg",sx:{py:4},children:[e.jsxs(i,{component:R.div,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},sx:{mb:4},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(b,{fontSize:"large",color:"primary"}),e.jsx(c,{variant:"h4",component:"h1",fontWeight:700,children:"Notifikasi"}),m>0&&e.jsx(q,{label:`${m} baru`,size:"small",color:"primary",sx:{fontWeight:600,ml:1}})]}),e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx(_,{variant:"outlined",color:"primary",startIcon:e.jsx(we,{}),onClick:se,sx:{borderRadius:2,textTransform:"none",fontWeight:600},children:de}),e.jsx(A,{title:"Opsi lainnya",children:e.jsx(N,{onClick:ae,children:e.jsx(Me,{})})})]})]}),e.jsxs(be,{elevation:0,variant:"outlined",sx:{borderRadius:2,overflow:"hidden"},children:[e.jsxs(De,{value:l,onChange:ee,sx:{borderBottom:`1px solid ${y(s.palette.divider,.1)}`,"& .MuiTab-root":{py:2,textTransform:"none",fontWeight:600,minWidth:100}},children:[e.jsx(W,{label:"Semua"}),e.jsx(W,{label:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(c,{children:"Belum Dibaca"}),m>0&&e.jsx(q,{label:m,size:"small",color:"primary",sx:{fontWeight:600,height:20,minWidth:20}})]})}),e.jsx(W,{label:"Sudah Dibaca"})]}),h&&e.jsx(i,{sx:{p:4,textAlign:"center"},children:e.jsx(c,{children:"Memuat notifikasi..."})}),!h&&T.length>0?e.jsx(Ne,{disablePadding:!0,children:T.map((a,t)=>e.jsxs(fe.Fragment,{children:[t>0&&e.jsx(We,{component:"li"}),e.jsxs(Te,{sx:{py:2,px:3,backgroundColor:a.read?"transparent":y(s.palette.primary.light,.05),borderLeft:a.read?"none":`4px solid ${s.palette.primary.main}`,transition:"all 0.2s ease","&:hover":{backgroundColor:y(s.palette.primary.light,.1),cursor:"pointer"}},onClick:()=>pe(a),children:[e.jsx(C,{sx:{minWidth:40},children:e.jsx(Ae,{sx:{width:40,height:40,bgcolor:y(E(a.type),.1),color:E(a.type)},children:a.icon})}),e.jsx(v,{primary:e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(c,{variant:"subtitle1",fontWeight:a.read?500:700,children:a.title}),e.jsx(c,{variant:"caption",color:"text.secondary",children:a.time})]}),secondary:e.jsx(c,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:a.message}),sx:{my:0}}),e.jsxs(i,{sx:{display:"flex",ml:1},children:[!a.read&&e.jsx(A,{title:"Tandai sudah dibaca",children:e.jsx(N,{size:"small",onClick:r=>{r.stopPropagation(),L(a.id)},sx:{color:s.palette.primary.main},children:e.jsx(V,{fontSize:"small"})})}),e.jsx(A,{title:"Hapus notifikasi",children:e.jsx(N,{size:"small",onClick:r=>{r.stopPropagation(),le(a.id)},sx:{color:s.palette.error.main},children:e.jsx(Z,{fontSize:"small"})})})]})]})]},a.id))}):!h&&e.jsxs(i,{sx:{py:8,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[l===1?e.jsx(ve,{sx:{fontSize:48,color:"text.secondary",mb:2,opacity:.5}}):e.jsx(b,{sx:{fontSize:48,color:"text.secondary",mb:2,opacity:.5}}),e.jsx(c,{variant:"h6",color:"text.secondary",sx:{mb:1},children:l===1?"Tidak ada notifikasi yang belum dibaca":l===2?"Tidak ada notifikasi yang sudah dibaca":"Tidak ada notifikasi"}),e.jsx(c,{variant:"body2",color:"text.secondary",children:l===1?"Semua notifikasi Anda telah dibaca":l===2?"Anda belum memiliki notifikasi yang sudah dibaca":"Anda akan menerima notifikasi tentang lowongan, aplikasi, dan aktivitas lainnya di sini"})]}),o&&o.links&&o.links.length>3&&e.jsx(i,{sx:{p:2,display:"flex",justifyContent:"center",borderTop:`1px solid ${y(s.palette.divider,.1)}`},children:e.jsx(Fe,{count:Math.ceil(o.total/o.per_page),page:o.current_page,onChange:ce,color:"primary",shape:"rounded"})})]})]}),e.jsx(i,{component:R.div,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2},children:e.jsx(Le,{variant:"outlined",sx:{borderRadius:2},children:e.jsxs($e,{children:[e.jsx(c,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Pengaturan Notifikasi"}),e.jsx(c,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Anda dapat mengubah preferensi notifikasi Anda di halaman pengaturan. Pilih jenis notifikasi yang ingin Anda terima melalui email atau di platform."}),e.jsx(_,{variant:"contained",color:"primary",startIcon:e.jsx(P,{}),component:ye,href:`${f()}/profile`,sx:{borderRadius:2,textTransform:"none",fontWeight:600},children:"Atur Preferensi Notifikasi"})]})})})]}),e.jsxs(U,{anchorEl:M,open:!!M,onClose:te,PaperProps:{elevation:2,sx:{minWidth:200,borderRadius:2,mt:1,boxShadow:s.shadows[3]}},children:[e.jsxs(w,{onClick:ie,sx:{py:1.5},disabled:h||m===0,children:[e.jsx(C,{children:e.jsx(V,{fontSize:"small"})}),e.jsx(v,{primary:"Tandai semua sudah dibaca"})]}),e.jsxs(w,{onClick:oe,sx:{py:1.5},disabled:h||u.length===0,children:[e.jsx(C,{children:e.jsx(Z,{fontSize:"small",color:"error"})}),e.jsx(v,{primary:"Hapus semua notifikasi"})]})]}),e.jsx(U,{anchorEl:D,open:!!D,onClose:re,PaperProps:{elevation:2,sx:{minWidth:200,borderRadius:2,mt:1,boxShadow:s.shadows[3]}},children:$.map(a=>e.jsxs(w,{onClick:()=>ne(a.type),selected:n===a.type,sx:{py:1.5,borderRadius:1,mx:.5,my:.2},children:[e.jsx(C,{sx:{color:n===a.type?s.palette.primary.main:"inherit"},children:a.icon}),e.jsx(v,{primary:a.label,primaryTypographyProps:{fontWeight:n===a.type?600:400}})]},a.type))})]})};export{xa as default};
